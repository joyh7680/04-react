/*
1) ìƒíƒœ(state)ë¥¼ ë¨¼ì € ì •ì˜í•˜ê¸°

â€œì•±ì—ì„œ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ë°ì´í„°ê°€ ë­ì§€?â€ë¶€í„° ìƒê°.

ğŸ‘‰ ì¥ë°”êµ¬ë‹ˆë¼ë©´ ê´€ë¦¬í•´ì•¼ í•  ê±´ ìƒí’ˆ ëª©ë¡(items)
ìƒí’ˆì—ëŠ” id, name, price, quantityê°€ í¬í•¨ë  ìˆ˜ ìˆìŒ.
*/
const initialState = {
  items: []  // ìƒí’ˆ ëª©ë¡
}

/**
 2) ìƒíƒœë¥¼ ë°”ê¿€ í•¨ìˆ˜(reducer)ë¥¼ ë§Œë“ ë‹¤
â€œì´ ìƒíƒœë¥¼ ì–´ë–»ê²Œ ë°”ê¾¸ëŠ” ìƒí™©ë“¤ì´ ìˆì„ê¹Œ?â€ë¥¼ ë– ì˜¬ë¦¼.
ì¦‰, â€˜ì¥ë°”êµ¬ë‹ˆì—ì„œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì¼(í–‰ë™)â€™ë“¤ì„ ìƒê°.
ì´ëŸ° ê±¸ ì•¡ì…˜(action) ì´ë¼ê³  ë¶€ë¦„.

ì¥ë°”êµ¬ë‹ˆì¶”ê°€ê¸°ëŠ¥ - ìˆ˜ëŸ‰ë§Œ ì¶”ê°€í•  ê²½ìš° / ì‹ ê·œ ì¶”ê°€í•  ê²½ìš° 
ì¥ë°”êµ¬ë‹ˆì˜ ì•„ì´í…œ ì‚­ì œ 
ì¥ë°”êµ¬ë‹ˆì•„ì´í…œ ìˆ˜ëŸ‰ ì¶”ê°€
ì¥ë°”êµ¬ë‹ˆì•„ì´í…œ ìˆ˜ëŸ‰ ê°ì†Œ
ì¥ë°”êµ¬ë‹ˆì „ì²´ì‚­ì œ
 */
function reviewCarReducer(state, action) {
  switch(action.type){
    case 'ADD-ITEM':

    // 0)ì¥ë°”êµ¬ë‹ˆì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ìƒí’ˆì´ ìˆëŠ”ì§€ ì°¾ì•„ì„œ existingItemì— ì €ì¥â€
    const existingItem = state.items.find((item) => item.id === action.payload.id )

    if(existingItem) {
      return{
        ...state, //ê¸°ì¡´ ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬ 
            // state.items â†’ í˜„ì¬ ì¥ë°”êµ¬ë‹ˆ ì•ˆì— ë“¤ì–´ìˆëŠ” ìƒí’ˆ ë°°ì—´
                        // .map() â†’ ë°°ì—´ì˜ ê° ìš”ì†Œ(item)ë¥¼ í•˜ë‚˜ì”© ìˆœíšŒí•˜ë©´ì„œ ìƒˆ ë°°ì—´ì„ ë§Œë“œëŠ” í•¨ìˆ˜
        items: state.items.map((item) =>
                          //payload = actionì— ë‹´ê¸´ ë°ì´í„° 
                          // payload ìì²´ê°€ â€œì´ ì•¡ì…˜ì´ ë™ì‘í•  ëŒ€ìƒâ€**ì„ ë‹´ê³  ìˆëŠ” ê°’
          item.id === action.payload ? {...item, quantity: item.quantity +1}
                                     : item
        )
      }
    }else {
        return {
          ...state, //ë¦¬ë“€ì„œì—ì„œ í•­ìƒ ìƒˆ ìƒíƒœ ê°ì²´ë¥¼ ë°˜í™˜, ê¸°ì¡´ ìƒíƒœì˜ **ëª¨ë“  ì†ì„±(ì˜ˆ: items, totalPrice, user ë“±)**ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬
          items: [ //ìƒˆ ìƒíƒœ ê°ì²´ ì•ˆì—ì„œ itemsë¼ëŠ” ì†ì„±ì„ ìƒˆ ë°°ì—´ë¡œ ë°”ê¾¸ê² ë‹¤ëŠ” ì˜ë¯¸
            ...state.itmes, //ê¸°ì¡´ ë°°ì—´ì„ â€œí’€ì–´ì„œ ìƒˆ ë°°ì—´ ì•ˆì— ë„£ëŠ”ë‹¤â€
            {...action.payload, quantity:1}
          ]
        }
      }

    //ì•¡ì…˜2) ì¥ë°”êµ¬ë‹ˆì•ˆì— ìˆëŠ” ì•„ì´í…œ ì‚­ì œ 
    //ì‚­ì œë²„íŠ¼ í´ë¦­ìŠ¤ ê·¸ ì•„ì´í…œë§Œ ì‚­ì œë˜ì–´ì•¼í•¨ => filter ê·¸ ì•„ì´í…œë§Œ ì œì™¸í•œ ë‚˜ë¨¸ì§€ë¥¼ ë‚¨ê²¨ì•¼í•¨ => ì œì™¸. ì‚­ì œíš¨ê³¼
    case 'DELETE-ITEM':
      return {
        ...state,
        items: state.item.fliter((item) => item.id !== action.payload.id )
      }

    //ì•¡ì…˜3) ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ìˆ˜ëŸ‰ ì¦ê°€
    //ì‚¬ê³ )   í”ŒëŸ¬ìŠ¤ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ì•„ì´í…œì˜ ìˆ«ìê°€ ì¦ê°€ëŒ . ì¥ë°”êµ¬ë‹ˆì•ˆì—ìˆëŠ” ê¸°ì¡´ ì•„ì´í…œê°€ì§€ê³  ì‘ì—… => ë°°ì—´ ëŒì•„ì•¼ì§€ => mapìƒê°, 
    // í•´ë‹¹ idê°€ ë§ëŠ”ì§€ ì•ˆë§ëŠ”ì§€ë„ ìƒê° => ì‚¼í•­ì—°ì‚°ì
    case 'PLUS-ITEM':
      return{
        ...state,         
                        //map ëŒë©´ì„œ, idê°€ ì¼ì¹˜í•˜ëŠ” ìƒí’ˆë§Œ ìˆ˜ëŸ‰ ì¦ê°€ / ê·¸ê²Œ ì•„ë‹ˆë¼ë©´ ê·¸ëŒ€ë¡œ ë‘ê¸°
        items: state.items.map((item) => 
          item.id === action.payload ? {...item, quantity: item.quantity +1} //...item, :ê¸°ì¡´ ì†ì„±(id, name)ì€ ê·¸ëŒ€ë¡œ ë‘ê³ , quantity: item.quantity +1 quantityë§Œ ìƒˆ ê°’ìœ¼ë¡œ ë®ì–´ì“°ê¸°
                                      : item
        )
      }

      // ì•¡ì…˜4) ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ìˆ˜ëŸ‰ ê°ì†Œ (í•„ìš”í•œ ë°ì´í„°: ìˆ˜ëŸ‰ ê°ì†Œí•  ì•„ì´í…œ id)
      //ì‚¬ê³  ) ë§ˆì´ë„ˆìŠ¤ í´ë¦­ì‹œ í•´ë‹¹ ì•„ì´í…œ ìˆ«ì ê°ì†Œ 
    case 'MINUS-ITEM':
      return {
        ...state,   //@í•´ë‹¹í•˜ëŠ” ì•„ì´í…œì—ì„œë§Œ -ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ”ê±´ë° map ì´ê±¸ ì™œì”€?

        items: state.items.map((item) => 
          item.id === action.payload ? {...item, quantity: Math.max(item.quantity -1, 1)} // * `.max()` â†’ ì „ë‹¬í•œ ê°’ë“¤ ì¤‘ **ê°€ì¥ í° ê°’** ë°˜í™˜
                                    : item
        
        )
      }

       //ì•¡ì…˜5) ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ì‚­ì œ
    case 'ALL-DELETE':
      return initialState;

      //í˜„ì¬ìƒíƒœ
      default:
        return state;
      
  }
}

export {initialState, reviewCarReducer}

/**
 * ...state â†’ ê¸°ì¡´ ìƒíƒœ ê°ì²´ ë³µì‚¬

ì´ìœ : ë¦¬ë“€ì„œì—ì„œëŠ” ìƒíƒœ ê°ì²´ ì „ì²´ë¥¼ ìƒˆë¡œ ë°˜í™˜í•´ì•¼ í•˜ëŠ”ë°,
ì¥ë°”êµ¬ë‹ˆì—ëŠ” items ì™¸ì—ë„ ë‹¤ë¥¸ ìƒíƒœê°€ ìˆì„ ìˆ˜ ìˆìŒ (ì˜ˆ: user, totalPrice ë“±)

...state ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì†ì„±ì€ ë‚ ì•„ê° â†’ ê¸°ì¡´ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ í•„ìš”
 */